<?php
session_start();

//**Check if the user is NOT logged in** (Security Check)
if (!isset($_SESSION['loggedin']) || $_SESSION['loggedin'] !== true) {
    //If not logged in, redirect to the login page
    header("Location: login.php");
    exit;
}

//If the code reaches here, the user has been authenticated.
$user_FullName = $_SESSION['FullName'];
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Transactions</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        @import "standardized_project_formatting.css";

        .scroll-box {
            height: 180px;
            overflow-y: auto;
            border: 1px solid #aaa;
            padding: 10px;
            border-radius: 6px;
            background-color: white;
        }

        .transactions-banner {
            background-color: #0f6fab;
            color: white;
            padding: 20px;
            font-size: 40px;
            margin-top: 20px;
            border-radius: 6px;
            font-family: Cambria, serif;
        }
    </style>
</head>

<body>

<h1 class="transactions-banner">Company Transactions</h1>

<div class="container">
    <div class="row">

        <!-- Sidebar -->
        <div class="col-md-3">
            <div id="supplychainmanager_sidebar"></div>
            <script>
                fetch('supplychainmanager_sidebar.html')
                    .then(response => response.text())
                    .then(html => document.getElementById('supplychainmanager_sidebar').innerHTML = html);
            </script>
        </div>

        <!-- Main Content -->
        <div class="col-md-9">

            <!-- Dashboard header -->
            <div class="card" id="dashboard-header">
                <?php echo "{$user_FullName}'s SCM Dashboard" ?>
            </div>

            <!-- Company Form -->
            <form action="#" method="post" name="CompanyForm" class="mt-3">
                <label>Company Name</label>
                <input type="text" class="form-control" name="CompanyName">

                <label class="mt-2">Location Type</label>
                <select class="form-control" name="LocationType"> <!-- Press Menu -->
                    <option>Country</option>
                    <option>State</option>
                    <option>City</option>
                </select>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <label>Start Date</label>
                        <input type="date" class="form-control" name="StartDate"> <!-- Date Picker -->
                    </div>

                    <div class="col-md-6">
                        <label>End Date</label>
                        <input type="date" class="form-control" name="EndDate">
                    </div>
                </div>

                <button type="button" onclick="PullFromPHP()" class="btn btn-primary mt-3">Submit</button>
            </form>

            <!-- Leaving / Arriving Boxes -->
            <div class="row mt-4">

                <div class="col-md-6">
                    <h5>Leaving From</h5>
                    <div class="scroll-box">
                        <p>Location A</p>
                        <p>Location B</p>
                        <p>Location C</p>
                        <p>Location D</p>
                        <p>Location E</p>
                    </div>
                </div>

                <div class="col-md-6">
                    <h5>Arriving At</h5>
                    <div class="scroll-box">
                        <p>Location X</p>
                        <p>Location Y</p>
                        <p>Location Z</p>
                        <p>Location W</p>
                        <p>Location M</p>
                    </div>
                </div>

            </div>

        </div> <!-- END col-md-9 -->

    </div> <!-- END row -->
</div> <!-- END container -->

<script>
function PullFromPHP() {
    const input = document.CompanyForm.CompanyName.value;
    xhtpp = new XMLHttpRequest();
    xhtpp.onload = function(){
      if (this.readyState == 4 && this.status == 200) {
        const object = JSON.parse(this.responseText);
        index_zero = object[0];
        document.getElementById("type").innerHTML = "Type: " + index_zero.Type;
        document.getElementById("tier").innerHTML = "Tier: " + index_zero.TierLevel;
        document.getElementById("score").innerHTML = "Financial Health Score: " + index_zero.HealthScore;
      }
  };
    xhtpp.open("GET", "supplychainmanager_homepage_queries.php?q=" + input, true);
    xhtpp.send();
}
</script>

</body>
</html>